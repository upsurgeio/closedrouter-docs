---
title: "Structured Outputs"
description: "Pineapple supports structured outputs for compatible models, ensuring responses follow a strict JSON Schema.  
This is especially useful when you need consistent, machine-readable responses in production pipelines."
---

### Overview

Structured outputs allow you to:

1. Enforce JSON Schema validation on model responses  
2. Get consistent, type-safe outputs  
3. Avoid parsing errors and hallucinated fields  
4. Simplify downstream integrations

### Using Strucutred Outputs

Include a `response_format` parameter in your request with `type` set to `json_schema`.  

The `json_schema` object defines the exact structure you want.

```json
title="Example Request"
{
  "model": "openai/gpt-4o",
  "messages": [
    { "role": "user", "content": "What's the weather like in London?" }
  ],
  "response_format": {
    "type": "json_schema",
    "json_schema": {
      "name": "weather",
      "strict": true,
      "schema": {
        "type": "object",
        "properties": {
          "location": { "type": "string", "description": "City or location name" },
          "temperature": { "type": "number", "description": "Temperature in Celsius" },
          "conditions": { "type": "string", "description": "Weather conditions description" }
        },
        "required": ["location", "temperature", "conditions"],
        "additionalProperties": false
      }
    }
  }
}
```

The model will return a JSON object that strictly follows your schema:

```json
{
  "location": "London",
  "temperature": 18,
  "conditions": "Partly cloudy with light drizzle"
}
```

### Model Support

Structured outputs are supported on select Pineapple models:

- **OpenAI** → `openai/gpt-4o`, `openai/gpt-4o-mini`
- **Anthropic** → `anthropic/claude-3-5-sonnet-20241022`, `anthropic/claude-3-opus-20240229`

### Best Practices

1. **Add property descriptions -\>** Guides the model to populate fields correctly.
2. **Use **`strict: true`**-\>**  Ensure no unexpected or hallucinated fields.
3. **Keep schemas lena -\>** Simpler schemas yield more reliable results.

### Example Implementation

```typescript typescript
const response = await fetch('https://api.closedrouter.ai/v1/chat/completions', {
  method: 'POST',
  headers: {
    Authorization: 'Bearer {{API_KEY_REF}}',
    'Content-Type': 'application/json',
  },
  body: JSON.stringify({
    model: 'openai/gpt-4o',
    messages: [{ role: 'user', content: 'What is the weather like in London?' }],
    response_format: {
      type: 'json_schema',
      json_schema: {
        name: 'weather',
        strict: true,
        schema: {
          type: 'object',
          properties: {
            location: { type: 'string', description: 'City or location name' },
            temperature: { type: 'number', description: 'Temperature in Celsius' },
            conditions: { type: 'string', description: 'Weather conditions description' }
          },
          required: ['location', 'temperature', 'conditions'],
          additionalProperties: false,
        },
      },
    },
  }),
});
const data = await response.json();
const weatherInfo = data.choices[0].message.content;
```

```python python
import requests

response = requests.post(
  "https://api.closedrouter.ai/v1/chat/completions",
  headers={
    "Authorization": f"Bearer {{API_KEY_REF}}",
    "Content-Type": "application/json",
  },
  json={
    "model": "openai/gpt-4o",
    "messages": [
      {"role": "user", "content": "What is the weather like in London?"},
    ],
    "response_format": {
      "type": "json_schema",
      "json_schema": {
        "name": "weather",
        "strict": True,
        "schema": {
          "type": "object",
          "properties": {
            "location": {"type": "string", "description": "City or location name"},
            "temperature": {"type": "number", "description": "Temperature in Celsius"},
            "conditions": {"type": "string", "description": "Weather conditions description"},
          },
          "required": ["location", "temperature", "conditions"],
          "additionalProperties": False,
        },
      },
    },
  },
)
data = response.json()
weather_info = data["choices"][0]["message"]["content"]
```

### Streaming with Structured Outputs

Structured outputs also work with streaming.\
Just add "stream" : true to your request:

```json json
{
  "stream": true,
  "response_format": {
    "type": "json_schema",
    "json_schema": {
      "name": "weather",
      "strict": true,
      "schema": { "...": "..." }
    }
  }
}
```

### Error Handling

You may encounter:

1. **Model does not support structured outputs** -\> Error response with `unsupported_parameter`
2. **Invalid JSON Schema** -\> Request rejected before completion.
3. **Schema violation** -\> Response may fail validation in strict mode.

With Pineapple, you can unify structured outputs across **OpenAI** and **Anthropic**, without needing different request formats.